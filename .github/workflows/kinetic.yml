# generated by `./generate_action_config.py kinetic`
# jsk_travis
on: [push, pull_request]

jobs:
  kinetic:
    runs-on: ubuntu-latest
    name: ${{ matrix.name }}

    container: jskrobotics/ros-ubuntu:16.04

    strategy:
      matrix:
        include:
          - name: kinetic
            USE_DEB: true
            NOT_TEST_INSTALL: false
            TEST_PKGS: 'hrpsys_tools openrtm_tools rosnode_rtc rtmbuild hrpsys_ros_bridge openrtm_ros_bridge'
            EXTRA_DEB: ''
            ADDITIONAL_ENV_TO_DOCKER: ''
            IS_EUSLISP_TRAVIS_TEST: false
          - name: kinetic-src
            # Install libopencv-dev manually to compile hrpsys-simulator in hrpsys-base on kinetic
            # Details: https://github.com/start-jsk/rtmros_common/pull/1091#issuecomment-611457804
            #          https://github.com/start-jsk/rtmros_common/pull/1091#issuecomment-611476618
            USE_DEB: false
            NOT_TEST_INSTALL: true
            TEST_PKGS: 'hrpsys_tools openrtm_tools rosnode_rtc rtmbuild hrpsys_ros_bridge openrtm_ros_bridge'
            EXTRA_DEB: 'libopencv-dev'
            ADDITIONAL_ENV_TO_DOCKER: ''
            IS_EUSLISP_TRAVIS_TEST: false
          - name: kinetic-eustest
            USE_DEB: true
            NOT_TEST_INSTALL: false
            TEST_PKGS: 'hrpsys_ros_bridge'
            EXTRA_DEB: 'ros-kinetic-hrpsys-ros-bridge ros-kinetic-pr2eus'
            ADDITIONAL_ENV_TO_DOCKER: 'IS_EUSLISP_TRAVIS_TEST'
            IS_EUSLISP_TRAVIS_TEST: true
          - name: kinetic-src-eustest
            # Install libopencv-dev manually to compile hrpsys-simulator in hrpsys-base on kinetic
            # Details: https://github.com/start-jsk/rtmros_common/pull/1091#issuecomment-611457804
            #          https://github.com/start-jsk/rtmros_common/pull/1091#issuecomment-611476618
            USE_DEB: false
            NOT_TEST_INSTALL: true
            TEST_PKGS: 'hrpsys_ros_bridge'
            EXTRA_DEB: 'libopencv-dev ros-kinetic-hrpsys-ros-bridge ros-kinetic-pr2eus'
            ADDITIONAL_ENV_TO_DOCKER: 'IS_EUSLISP_TRAVIS_TEST'
            IS_EUSLISP_TRAVIS_TEST: true
          - name: kinetic-src-with-libopenni2-dev-libpcl-dev
            # To catch https://github.com/start-jsk/rtmros_common/pull/1090#issuecomment-610860446
            USE_DEB: false
            NOT_TEST_INSTALL: true
            TEST_PKGS: 'hrpsys_tools openrtm_tools rosnode_rtc rtmbuild hrpsys_ros_bridge openrtm_ros_bridge'
            EXTRA_DEB: 'libopencv-dev libopenni2-dev libpcl-dev'
            ADDITIONAL_ENV_TO_DOCKER: ''
            IS_EUSLISP_TRAVIS_TEST: false

    steps:
      - name: Install latest git ( use sudo for ros-ubuntu, remove sudo for ubuntu container), checkout@v2 uses REST API for git<2.18, which removes .git folder and does not checkout .travis submodules
        run: sudo apt-get update && sudo apt-get install -y software-properties-common && sudo apt-get update && sudo add-apt-repository -y ppa:git-core/ppa && sudo apt-get update && sudo apt-get install -y git
      - name: Before Checkout # need for actions/checkout with ros-ubuntu container
        run: sudo chown -R user:jenkins $RUNNER_WORKSPACE $HOME
      - name: Checkout
        uses: actions/checkout@v2
      - name: Run jsk_travis
        uses: jsk-ros-pkg/jsk_travis@master
        with:
          ROS_DISTRO : kinetic
          CATKIN_PARALLEL_JOBS: '-p1'
          CATKIN_PARALLEL_TEST_JOBS: '-p1'
          ROS_PARALLEL_JOBS: "-j1"
          ROS_PARALLEL_TEST_JOBS: '-j1'
          USE_DEB: ${{ matrix.USE_DEB }}
          NOT_TEST_INSTALL: ${{ matrix.NOT_TEST_INSTALL }}
          TEST_PKGS: ${{ matrix.TEST_PKGS }}
          EXTRA_DEB: ${{ matrix.EXTRA_DEB }}
          ADDITIONAL_ENV_TO_DOCKER: ${{ matrix.ADDITIONAL_ENV_TO_DOCKER }}
          IS_EUSLISP_TRAVIS_TEST: ${{ matrix.IS_EUSLISP_TRAVIS_TEST }}
